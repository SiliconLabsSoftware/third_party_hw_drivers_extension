/***************************************************************************//**
 * @file app.c
 * @brief Example application
 *******************************************************************************
 * # License
 * <b>Copyright 2024 Silicon Laboratories Inc. www.silabs.com</b>
 *******************************************************************************
 *
 * SPDX-License-Identifier: Zlib
 *
 * The licensor of this software is Silicon Laboratories Inc.
 *
 * This software is provided \'as-is\', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 *
 *******************************************************************************
 *
 * EVALUATION QUALITY
 * This code has been minimally tested to ensure that it builds with the
 * specified dependency versions and is suitable as a demonstration for
 * evaluation purposes only.
 * This code will be maintained at the sole discretion of Silicon Labs.
 *
 ******************************************************************************/
#include <string.h>
#include "mikroe_eink_display_config.h"
#include "mikroe_eink_display.h"
#include "glib.h"

#if (defined(SLI_SI917))
#include "sl_si91x_gspi.h"

static sl_gspi_instance_t gspi_instance = SL_GSPI_MASTER;
#else
#include "sl_spidrv_instances.h"
#endif

const char *str1 = "SILICON LABS";
const char *str2 = "APPLICATION EXAMPLE";

static mikroe_spi_handle_t app_spi_instance = NULL;
static glib_context_t g_context;

const uint8_t EINK_LUT_TABLE[] =
{
#if (CONFIG_EINK_DISPLAY_RESOLUTION == EINK_DISPLAY_1_54_INCH)
  0x02, 0x02, 0x01, 0x11, 0x12, 0x12, 0x22, 0x22,
  0x66, 0x69, 0x69, 0x59, 0x58, 0x99, 0x99, 0x88,
  0x00, 0x00, 0x00, 0x00, 0xF8, 0xB4, 0x13, 0x51,
  0x35, 0x51, 0x51, 0x19, 0x01, 0x00
#elif (CONFIG_EINK_DISPLAY_RESOLUTION == EINK_DISPLAY_2_13_INCH)
  0xA0, 0x90, 0x50, 0x00, 0x00, 0x00, 0x00,
  0x50, 0x90, 0xA0, 0x00, 0x00, 0x00, 0x00,
  0xA0, 0x90, 0x50, 0x00, 0x00, 0x00, 0x00,
  0x50, 0x90, 0xA0, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x0F, 0x0F, 0x0F, 0x0F, 0x02, 0x10, 0x10,
  0x0A, 0x0A, 0x03, 0x08, 0x08, 0x09, 0x43,
  0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#elif (CONFIG_EINK_DISPLAY_RESOLUTION == EINK_DISPLAY_2_90_INCH)
  0xA0, 0x90, 0x50, 0x00, 0x00, 0x00, 0x00,
  0x50, 0x90, 0xA0, 0x00, 0x00, 0x00, 0x00,
  0xA0, 0x90, 0x50, 0x00, 0x00, 0x00, 0x00,
  0x50, 0x90, 0xA0, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x0F, 0x0F, 0x0F, 0x0F, 0x02, 0x10, 0x10,
  0x0A, 0x0A, 0x03, 0x08, 0x08, 0x09, 0x43,
  0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#endif
};

static const unsigned char silicon_labs_logo_96x35[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x00, 0x00, 0xe0, 0x03,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0x07,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xff, 0xff, 0x3f, 0x00, 0xc0, 0x1f,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x00, 0xe0, 0x3f,
  0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff, 0xff, 0x7f, 0x00, 0xf0, 0x7f,
  0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0xff, 0xff, 0x3f, 0x00, 0xf8, 0x7f,
  0x00, 0x80, 0x01, 0x00, 0xf8, 0xff, 0xff, 0xff, 0x1f, 0x00, 0xfe, 0x7f,
  0x00, 0xe0, 0x00, 0x00, 0xfc, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff,
  0x00, 0x78, 0x00, 0x00, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xcf, 0xff, 0xff,
  0x00, 0x3c, 0x00, 0x00, 0xfe, 0x7f, 0x00, 0x00, 0xf8, 0xff, 0xff, 0x7f,
  0x00, 0x3f, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x7f,
  0x80, 0x3f, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x3f,
  0xe0, 0x3f, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xff, 0x3f,
  0xf0, 0x3f, 0x00, 0x00, 0x80, 0xff, 0x1f, 0x00, 0x00, 0x80, 0xff, 0x1f,
  0xf8, 0x7f, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x01, 0x00, 0x80, 0xff, 0x0f,
  0xfc, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0xff, 0x07,
  0xfc, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0xff, 0x01,
  0xfe, 0xff, 0x3f, 0x00, 0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0xff, 0x00,
  0xfe, 0xff, 0xff, 0x1f, 0x00, 0xc0, 0xff, 0x0f, 0x00, 0x80, 0x3f, 0x00,
  0xfe, 0xff, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0x0f, 0x00,
  0xfe, 0x0f, 0x00, 0xfe, 0xff, 0xff, 0xff, 0x07, 0x00, 0xe0, 0x03, 0x00,
  0xfe, 0x03, 0x00, 0xfe, 0xff, 0xff, 0xff, 0x03, 0x00, 0xf0, 0x00, 0x00,
  0xfe, 0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x38, 0x00, 0x00,
  0xfc, 0x00, 0x80, 0xff, 0xff, 0xff, 0x7f, 0x00, 0x00, 0x0e, 0x00, 0x00,
  0xfc, 0x00, 0x80, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x80, 0x01, 0x00, 0x00,
  0xf0, 0x00, 0x80, 0xff, 0xff, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xe0, 0x00, 0x00, 0xfe, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x80, 0x00, 0x00, 0xe0, 0xff, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

void app_init(void)
{
#if (defined(SLI_SI917))
  app_spi_instance = &gspi_instance;
#else
  app_spi_instance = sl_spidrv_mikroe_handle;
#endif

  glib_init(&g_context);
  g_context.wrap = false;
  g_context.text_color = EINK_DISPLAY_SCREEN_COLOR_BLACK;
  g_context.bg_color = EINK_DISPLAY_SCREEN_COLOR_WHITE;

  mikroe_eink_display_init(app_spi_instance);
  mikroe_eink_display_start_config();
  mikroe_eink_display_set_lut(EINK_LUT_TABLE, sizeof(EINK_LUT_TABLE));

  glib_fill(&g_context, g_context.bg_color);
  glib_draw_xbitmap(&g_context,
                    (g_context.width - 96) / 2, 82,
                    silicon_labs_logo_96x35,
                    96, 35, g_context.text_color);
  glib_draw_string(&g_context, str1,
                   (g_context.width - strlen(str1) * 6 + 1) / 2, 140);
  glib_draw_string(&g_context, str2,
                   (g_context.width - strlen(str2) * 6 + 1) / 2, 160);
  glib_update_display();
}

/***************************************************************************//**
 * App ticking function.
 ******************************************************************************/
void app_process_action(void)
{
}
